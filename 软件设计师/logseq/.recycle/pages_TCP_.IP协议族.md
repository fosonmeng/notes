title:: TCP\/IP协议族

- TCP/IP作为Internet的核心协议，通过近20多年的发展已日渐成熟，并被广泛应用于局域网和广域网中，目前已成为事实上的国际标准。作为一个最早的、也是迄今为止发展最为成熟的互联网络协议系统，TCP/IP包含许多重要的基本特性，这些特性主要表现在5个方面：逻辑编址、路由选择、域名解析、错误检测和流量控制以及对应用程序的支持等。
	- ==逻辑编址==。每一块网卡在出厂时就由厂家分配了一个独一无二的永久性的物理地址。在Internet中，为每台连入因特网的计算机分配一个逻辑地址，这个逻辑地址被称为IP地址。一个IP地址可以包括一个网络ID号，用来标识网络；一个子网络ID号，用来标识网络上的一个子网；另外，还有一个主机ID号，用来标识子网络上的一台计算机。这样，通过这个分配给某台计算机的IP地址，就可以很快地找到相应的计算机。
	- ==路由选择==。在TCP/IP包含了专门用于定义路由器如何选择网络路径的协议，即IP数据包的路由选择。
	- ==域名解析==。虽然TCP/IP采用的是32位的IP地址，但考虑用户的记忆方便，专门设计了一种方便的字母式地址结构，称为域名或DNS（域名服务）名字。将域名映射为IP地址的操作，称为域名解析。域名具有较稳定的特点，而IP地址则较易发生变化。
	- ==错误检测与流量控制==。TCP/IP具有分组交换确保数据信息在网络上可靠传递的特性，这些特性包括检测数据信息的传输错误（保证到达目的地的数据信息没有发生变化），确认已传递的数据信息已被成功地接收，监测网络系统中的信息流量，防止出现网络拥塞。
	- ==应用程序的支持==。
- TCP/IP分层模型：
	- 协议是对数据在计算机或设备之间传输时的表示方法进行定义和描述的标准。协议规定了进行传输、检测错误以及传送确认信息等内容。TCP/IP是个协议簇，它包含了多种协议。ISO/OSI模型、TCP/IP的分层模型及协议的对比如图5-13所示。
	- 从图5-13可知，**TCP/IP分层模型**由4个层次构成，即应用层、传输层、网际层和网络接口层，各层的功能简述如下。
	  ![image-20210804133612811](https://img.mhugh.net/typora/image-20210804133612811.png)
	-
- **网络接口层**协议：TCP/IP协议不包含具体的物理层和数据链路层，只定义了网络接口层作为物理层作为物理层与网络层的接口规范。这个物理层可以是广域网，如X.25公用数据网；可以是局域网，如Ethernet、Token-Ring和FDDI等。任何物理网络只要按照这个接口规范开发网络接口驱动程序，都能够与TCP/IP协议集成起来。网络接口层处在TCP/IP协议的最底层，主要负责管理为物理网络准备数据所需的全部服务程序和功能。
- **网际层**协议——IP：
	- 网际层是整个TCP/IP簇的重点。在网际层定义的协议除了IP外，还有ICMP、ARP和RARP等几个重要的协议。
	- IP所提供的服务通常被认为是无连接的（connectionless）和不可靠的（unreliable）。事实上，在网络性能良好的情况下，IP传送的数据能够完好无损地到达目的地。所谓==无连接的传输==，是指没有确定目标系统在已做好接收数据准备之前就发送数据。与此相对应的就是面向连接的（connection oriented）传输（如TCP），在该类传输中，源系统与目的系统在应用层数据传送之前需要进行三次握手。至于不可靠的服务，是指目的系统不对成功接收的分组进行确认，IP只是尽可能地使数据传输成功。但是只要需要，上层协议必须实现用于保证分组成功提供的附加服务。
- ARP和RARP：
	- 地址解析协议（Address Resolution Protocol，ARP）及反地址解析协议（RARP）是驻留在网际层中的另一个重要协议。**ARP**的作用是==将IP地址转换为物理地址==，**RARP**的作用是将物理地址转换为IP地址。网络中的任何设备，主机、路由器和交换机等均有唯一的物理地址，该地址通过网卡给出，每个网卡出厂后都有不同的编号，这意味着用户所购买的网卡有着唯一的物理地址。另一方面，为了屏蔽底层协议及物理地址上的差异，IP协议又使用了IP地址，因此，在数据传输过程中，必须对IP地址与物理地址进行相互转换。
	- 用ARP进行IP地址到物理地址转换的过程为：当计算机需要与任何其他的计算机进行通信时，首先需要查询ARP高速缓存，如果ARP高速缓存中这个IP地址存在，便使用与它对应的物理地址，直接将数据报发送给所需的物理网卡；如果ARP高速缓存中没有该IP地址，那么ARP便在局域网上以广播方式发送一个ARP请求包。如果局域网上IP地址与某台计算机中的IP地址一致，那么该计算机便生成一个ARP应答信息，信息中包含对应的物理地址。ARP协议软件将IP地址与物理地址的组合添加到它的高速缓存中，这时即可开始数据通信。
	- RARP负责物理地址到IP地址的转换。这主要用于**无盘工作站**上，网络上的无盘工作站在网卡上有自己的物理地址，但无IP地址，因此必须有一个转换过程。为了完成这个转换过程，网络中有一个RARP服务器，网络管理员事先必须把网卡上的IP地址和相应的物理地址存储到IP RARP服务器的数据库中。
- 网际层协议——ICMP：
	- Internet控制信息协议（Internet Control Message Protocol，ICMP）是网际层的另一个比较重要的协议。由于IP是一种尽力传送的通信协议，即传送的数据报可能丢失、重复、延迟或乱序，因此IP需要一种避免差错并在发生差错时报告的机制。ICMP就是一个==专门用于发送差错报文==的协议。ICMP定义了5种差错报文（源抑制、超时、目的不可达、重定向和要求分段）和4种信息报文（回应请求、回应应答、地址屏蔽码请求和地址屏蔽码应答）。IP在需要发送一个差错报文时要使用ICMP，而ICMP也是利用IP来传送报文的。ICMP是让IP更加稳固、有效的一种协议，它使得IP传送机制变得更加可靠。而且利用ICMP还可以用于测试因特网，以得到一些有用的网络维护和排错的信息。例如，著名的ping工具就是利用ICMP报文进行目标是否可达测试。
- 传输层协议——TCP：
	- Transmission Control Protocol，传输控制协议，是整个TCP/IP协议族中最重要的协议之一。它在IP提供的不可靠数据服务的基础上，为应用程序提供了一个可靠的、面向连接的、==全双工==的数据传输服务。
	- TCP是如何实现可靠性的呢？最主要和最重要的是TCP采用了一个叫重发（retransmission）的技术。具体来说，在TCP传输过程中，发送方启动一个定时器，然后将数据包发出，当接收方收到了这个信息就给发送方一个确认（acknowledgement）信息。而如果发送方在定时器到点之前没收到这个确认信息，就重新发送这个数据包。
	- 利用TCP在源主机想和目的主机之间建立和关闭连接操作时，均需要通过三次握手来确认建立和关闭是否成功。三次握手方式如图5-14所示，它通过“序号/确认号”使得系统正常工作，从而使它们的序号达成同步。TCP建立连接的三次握手过程如下：
	  ![image-20210804160050460](https://img.mhugh.net/typora/image-20210804160050460.png)
		- 1. 源主机发送一个SYN（同步）标志位为1的TCP数据包，表示想与目标主机进行通信，并发送一个同步序列号（如SEQ=200）进行同步
		  2. 目标主机愿意进行通信，则响应一个确认（ACK位置1）。并以下一个序列号为参考进行确认（如201）
		  3. 源主机以确认来响应目标主机的TCP包。这个确认中包括它想要接收的下一个序列号（该帧可以含有发送的数据）。至此连接建立完成。
	- 同样，关闭连接也进行三次握手。
- 传输层协议——UDP：
	- 用户数据报协议（User Datagram Protocol，UDP）是一种不可靠的、无连接的协议，可以保证应用程序进程间的通信。与同样处在传输层的面向连接的TCP相比较，UDP是一种无连接的协议，它的错误检测功能要弱得多。可以这样说，TCP有助于提供可靠性；而UDP则有助于提高传输的高速率性。例如，必须支持交互式会话的应用程序（如DNS、SNMP等）则往往使用UDP。
	- UDP协议软件的主要作用就是将UDP消息展示给应用层，它并不负责重新发送丢失的或出错的数据消息，不对接收到的无序IP数据报重新排序，不消除重复的IP数据报，不对已收到数据报进行确认，也不负责建立或终止连接。而这些问题是由使用UDP进行通信的应用程序负责处理的问题。
	- TCP虽然提供了一个可靠的数据传输服务，但它是以牺牲==通信量==来实现的。也就是说，为完成同样一个任务，TCP会需要更多的时间和通信量。这在网络不可靠的时候，通过牺牲一些时间来达到网络的可靠，但当网络十分可靠的情况下，它又通过浪费带宽来保证可靠性，这时UDP则以十分小的通信量浪费占据优势。
- 应用层协议：
	- 随着计算机网络的广泛应用，人们也已经有了许多基本的、相同的应用需求。为了让不同平台的计算机能够通过计算机网络获得一些基本的、相同的服务，也就应运而生了一系列应用级的标准，实现这些应用标准的专用协议被称为应用级协议，相对于OSI参考模型来说，它们处于较高的层次结构，所以也称为高层协议。应用层的协议有NFS、Telnet、SMTP、DNS、SNMP和FTP等，详细情况在Internet服务中介绍。