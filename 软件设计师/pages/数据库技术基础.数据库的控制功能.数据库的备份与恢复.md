title:: 数据库技术基础/数据库的控制功能/数据库的备份与恢复
alias:: 数据库的备份与恢复

- ## 故障类型
	- **事务内部故障**。例如，银行转账事务，将账户A的金额转X到账户B，此时应该将账户A的余额-X，将账户B的余额+X。如果账户A的余额不足，那么，两个事务都不做，否则都做。但有些是非预期的，不能由事务程序处理，如运算溢出、并发事务发生死锁等。
	- **系统故障**。通常称为软故障，是指造成系统停止运行的任何事件，使得系统要重新启动，如CPU故障、操作系统故障和突然停电等。
	- **介质故障**。通常称为硬故障，如磁盘损坏、磁头碰撞和瞬时强磁干扰。此类故障发生几率小，但破坏性最大。
	- **计算机病毒**。
- ## 备份方法
	- 恢复的基本原理是“==建立数据冗余==”（重复存储）。建立冗余数据的方法是进行数据转储和登记日志文件。数据的转储分为静态转储和动态转储、海量转储和增量转储。
	- 静态转储和动态转储。**静态转储**是指在转储期间不允许对数据库进行任何存取、修改操作；**动态转储**是在转储期间允许对数据库进行存取、修改操作，因此，转储和用户事务可并发执行。
	- 海量转储和增量转储。**海量转储**是指每次转储全部数据；**增量转储**是指每次只转储上次转储后更新过的数据。
	- **日志文件**。在事务处理的过程中，DBMS把事务开始、事务结束以及对数据库的插入、删除和修改的每一次操作写入日志文件。一旦发生故障，DBMS的恢复子系统利用日志文件撤销事务对数据库的改变，回退到事务的初始状态。因此，DBMS利用日志文件来进行事务故障恢复和系统故障恢复，并可协助后备副本进行介质故障恢复。
- ## 恢复
	- 事务恢复有如下三个步骤：
	  > 1. 反向扫描文件日志（即从最后向前扫描日志文件），查找该事务的更新操作。
	  > 2. 对事务的更新操作执行逆操作。
	  > 3. 继续反向扫描日志文件，查找该事务的其他更新操作，并做同样的处理，直到事务开始标志。
- ## 数据库镜像
	- 为了避免磁盘介质出现故障影响数据库的可用性，许多DBMS提供库镜像功能用于数据库恢复。需要说明的是，数据库镜像是通过复制数据实现的，但频繁地复制数据会降低系统的运行效果。因此，实际应用中往往对关键的数据和日志文件镜像。